USE DEVDB
GO

-- ##################################################################################

-- OK
with Ramp_H1 as (
SELECT geometry::STGeomFromText('LINESTRING(2173369.79254475 259887.575230554 NULL 2600,2173381.122467 259911.320734575 NULL 2626.3106)',2274) as geom
)
SELECT a.geom as sqBuff from Ramp_H1 as a union all
SELECT [dbo].[STSquareBuffer] (d.geom, 100, 3, 1) as Geom from Ramp_H1 as d 
GO

-- OK
WITH Ramp_H1 as (
 select geometry::STGeomFromText('COMPOUNDCURVE ((2173369.79254475 259887.575230554 NULL 2600,2173381.122467 259911.320734575 NULL 2626.3106),
 CIRCULARSTRING (2173381.122467 259911.320734575 NULL 2626.3106,2173433.84355779 259955.557426129 NULL 0,2173501.82006501 259944.806018785 NULL 2768.24))',2274) as geom
 )
SELECT a.geom as sqBuff from Ramp_H1 as a union all
SELECT [dbo].[STSquareBuffer](a.geom, 50, 5, 4) as sqBuff from Ramp_H1 as a
GO

-- OK
WITH Ramp_H1 as (
 select geometry::STGeomFromText('COMPOUNDCURVE (
(2173369.79254475 259887.575230554 NULL 2600,2173381.122467 259911.320734575 NULL 2626.3106),
CIRCULARSTRING (2173381.122467 259911.320734575 NULL 2626.3106,2173433.84355779 259955.557426129 NULL 0,2173501.82006501 259944.806018785 NULL 2768.24))',2274) as geom
 )
SELECT a.geom as sqBuff from Ramp_H1 as a union all
SELECT [dbo].[STSquareBuffer](a.geom, 70, 4, 1) as sqBuff from Ramp_H1 as a
GO

-- OK
WITH RFP1 as (
 select geometry::STGeomFromText('COMPOUNDCURVE (
(2172150.6845635027 258351.6130952388 NULL 7500, 2171796.8166267127 257562.7279690057 NULL 8364.6171999999933), 
CIRCULARSTRING (2171796.8166267127 257562.7279690057 NULL 8364.6171999999933, 2171785.1539784111 257183.20449278614 NULL 0, 2172044.2970194966 256905.68157368898 NULL 9143.7173000000039), 
(2172044.2970194966 256905.68157368898 NULL 9143.7173000000039, 2172405.6545540541 256740.52740873396 NULL 9541.0274000000063), 
CIRCULARSTRING (2172405.6545540541 256740.52740873396 NULL 9541.0274000000063, 2172647.6470565521 256579.20296130711 NULL 0, 2172826.9283746332 256350.1960671097 NULL 10125.168300000005), 
(2172826.9283746332 256350.1960671097 NULL 10125.168300000005, 2172922.0147634745 256178.15253089368 NULL 10321.740000000005))',2274) as geom
)
SELECT a.geom as sqBuff from RFP1 as a union all
SELECT [dbo].[STSquareBuffer](a.geom, 50, 5, 4) as sqBuff from RFP1 as a
GO

-- OK
with Ramp_H as (
select geometry::STGeomFromText('COMPOUNDCURVE ((2173251.19755045 260565.663264811 NULL 2000,2173324.62503405 260532.888690099 NULL 2080.4098),
 CIRCULARSTRING (2173324.62503405 260532.888690099 NULL 2080.4098,2173345.78352624 260520.72691965 NULL 0,2173364.04390489 260504.535902888 NULL 2129.3036),
 CIRCULARSTRING (2173364.04390489 260504.535902888 NULL 2129.3036,2173381.19882422 260470.679448103 NULL 0,2173378.16228123 260432.846523359 NULL 2206.1746),
 (2173378.16228123 260432.846523359 NULL 2206.1746,2173355.55940427 260371.804622516 NULL 2271.2667,2173350.99754606 260362.115766078 NULL 2281.9758),
 CIRCULARSTRING (2173350.99754606 260362.115766078 NULL 2281.9758,2173336.7026266 260144.609642233 NULL 0,2173474.30695651 259975.558445781 NULL 2728.2803),
 (2173474.30695651 259975.558445781 NULL 2728.2803,2173476.92754695 259974.081665367 NULL 2731.2883),
 CIRCULARSTRING (2173476.92754695 259974.081665367 NULL 2731.2883,2173644.89258743 259822.983578196 NULL 0,2173732.74541767 259614.837554961 NULL 3186.7865),
 CIRCULARSTRING (2173732.74541767 259614.837554961 NULL 3186.7865,2173749.05001496 259459.972709981 NULL 0,2173742.0037621 259304.411434516 NULL 3498.52))',2274) as geom
)
SELECT a.geom as sqBuff from Ramp_H as a union all
SELECT [dbo].[STSquareBuffer](a.geom, 50, 5, 4) as sqBuff from Ramp_H as a
GO

-- OK
with Ramp_H1_Segmentized as (
SELECT v.*
 FROM [dbo].[STSegmentize] (
          geometry::STGeomFromText('COMPOUNDCURVE ((2173369.79254475 259887.575230554 NULL 2600,2173381.122467 259911.320734575 NULL 2626.3106),
                                    CIRCULARSTRING (2173381.122467 259911.320734575 NULL 2626.3106,2173433.84355779 259955.557426129 NULL 0,2173501.82006501 259944.806018785 NULL 2768.24))', 2274),
          'ALL',NULL,NULL,NULL,NULL,8,8,4
      ) as v
)
SELECT 'NULL' as wkt, 'Before' as text, d.segment as Geom, d.segment.AsTextZM() as rGeom from Ramp_H1_Segmentized as d
UNION ALL
SELECT d.segment.AsTextZM() as wkt,
       'Square Buffer' as text, 
        [dbo].[STSquareBuffer] (d.segment, 500, 3, 1) as Geom, 
        [dbo].[STSquareBuffer] (d.segment, 500, 3, 1).AsTextZM() as rGeom from Ramp_H1_Segmentized as d;
GO

-- OK
with Ramp_H as (
select geometry::STGeomFromText('COMPOUNDCURVE ((2173251.19755045 260565.663264811 NULL 2000,2173324.62503405 260532.888690099 NULL 2080.4098),
 CIRCULARSTRING (2173324.62503405 260532.888690099 NULL 2080.4098,2173345.78352624 260520.72691965 NULL 0,2173364.04390489 260504.535902888 NULL 2129.3036),
 CIRCULARSTRING (2173364.04390489 260504.535902888 NULL 2129.3036,2173381.19882422 260470.679448103 NULL 0,2173378.16228123 260432.846523359 NULL 2206.1746),
 (2173378.16228123 260432.846523359 NULL 2206.1746,2173355.55940427 260371.804622516 NULL 2271.2667,2173350.99754606 260362.115766078 NULL 2281.9758),
 CIRCULARSTRING (2173350.99754606 260362.115766078 NULL 2281.9758,2173336.7026266 260144.609642233 NULL 0,2173474.30695651 259975.558445781 NULL 2728.2803),
 (2173474.30695651 259975.558445781 NULL 2728.2803,2173476.92754695 259974.081665367 NULL 2731.2883),
 CIRCULARSTRING (2173476.92754695 259974.081665367 NULL 2731.2883,2173644.89258743 259822.983578196 NULL 0,2173732.74541767 259614.837554961 NULL 3186.7865),
 CIRCULARSTRING (2173732.74541767 259614.837554961 NULL 3186.7865,2173749.05001496 259459.972709981 NULL 0,2173742.0037621 259304.411434516 NULL 3498.52))',2274) as geom
)
SELECT [dbo].[STSquareBuffer](a.geom, 70, 5, 4) as sqBuff from Ramp_H as a
GO

-- ####################################################################################################

-- OK
with Ramp_H_Segmentized as (
SELECT v.*
 FROM [dbo].[STSegmentize] (
 geometry::STGeomFromText('COMPOUNDCURVE ((2173251.19755045 260565.663264811 NULL 2000,2173324.62503405 260532.888690099 NULL 2080.4098),
 CIRCULARSTRING (2173324.62503405 260532.888690099 NULL 2080.4098,2173345.78352624 260520.72691965 NULL 0,2173364.04390489 260504.535902888 NULL 2129.3036),
 CIRCULARSTRING (2173364.04390489 260504.535902888 NULL 2129.3036,2173381.19882422 260470.679448103 NULL 0,2173378.16228123 260432.846523359 NULL 2206.1746),
 (2173378.16228123 260432.846523359 NULL 2206.1746,2173355.55940427 260371.804622516 NULL 2271.2667,2173350.99754606 260362.115766078 NULL 2281.9758),
 CIRCULARSTRING (2173350.99754606 260362.115766078 NULL 2281.9758,2173336.7026266 260144.609642233 NULL 0,2173474.30695651 259975.558445781 NULL 2728.2803),
 (2173474.30695651 259975.558445781 NULL 2728.2803,2173476.92754695 259974.081665367 NULL 2731.2883),
 CIRCULARSTRING (2173476.92754695 259974.081665367 NULL 2731.2883,2173644.89258743 259822.983578196 NULL 0,2173732.74541767 259614.837554961 NULL 3186.7865),
 CIRCULARSTRING (2173732.74541767 259614.837554961 NULL 3186.7865,2173749.05001496 259459.972709981 NULL 0,2173742.0037621 259304.411434516 NULL 3498.52))', 2274),
 'ALL',NULL,NULL,NULL,NULL,8,8,4
 ) as v)
SELECT d.id, d.geometry_type, 'Before' as text, d.segment as Geom, d.segment.AsTextZM() as rGeom from Ramp_H_Segmentized as d
UNION ALL
SELECT d.id, d.geometry_type, 'Square Buffer' as text, [dbo].[STSquareBuffer] (d.segment, 500, 3, 1) as Geom, [dbo].[STSquareBuffer] (d.segment, 500, 3, 1).AsTextZM() as rGeom from Ramp_H_Segmentized as d;

-- OK
with Ramp_H_Segmentized as (
SELECT v.*
 FROM [dbo].[STSegmentize] (
 geometry::STGeomFromText('COMPOUNDCURVE ((2173251.19755045 260565.663264811 NULL 2000,2173324.62503405 260532.888690099 NULL 2080.4098),
 CIRCULARSTRING (2173324.62503405 260532.888690099 NULL 2080.4098,2173345.78352624 260520.72691965 NULL 0,2173364.04390489 260504.535902888 NULL 2129.3036),
 CIRCULARSTRING (2173364.04390489 260504.535902888 NULL 2129.3036,2173381.19882422 260470.679448103 NULL 0,2173378.16228123 260432.846523359 NULL 2206.1746),
 (2173378.16228123 260432.846523359 NULL 2206.1746,2173355.55940427 260371.804622516 NULL 2271.2667,2173350.99754606 260362.115766078 NULL 2281.9758),
 CIRCULARSTRING (2173350.99754606 260362.115766078 NULL 2281.9758,2173336.7026266 260144.609642233 NULL 0,2173474.30695651 259975.558445781 NULL 2728.2803),
 (2173474.30695651 259975.558445781 NULL 2728.2803,2173476.92754695 259974.081665367 NULL 2731.2883),
 CIRCULARSTRING (2173476.92754695 259974.081665367 NULL 2731.2883,2173644.89258743 259822.983578196 NULL 0,2173732.74541767 259614.837554961 NULL 3186.7865),
 CIRCULARSTRING (2173732.74541767 259614.837554961 NULL 3186.7865,2173749.05001496 259459.972709981 NULL 0,2173742.0037621 259304.411434516 NULL 3498.52))', 2274),
 'ALL',NULL,NULL,NULL,NULL,8,8,4
 ) as v)
SELECT d.id, d.geometry_type, 'Before' as text, d.segment as Geom, d.segment.AsTextZM() as rGeom from Ramp_H_Segmentized as d
UNION ALL
SELECT d.id, d.geometry_type, 'Square Buffer' as text, [dbo].[STSquareBuffer] (d.segment, 100, 3, 1) as Geom, [dbo].[STSquareBuffer] (d.segment, 100, 3, 1).AsTextZM() as rGeom from Ramp_H_Segmentized as d;

-- OK
with Ramp_H_Segmentized as (
SELECT v.*
 FROM [dbo].[STSegmentize] (
 geometry::STGeomFromText('COMPOUNDCURVE ((2173251.19755045 260565.663264811 NULL 2000,2173324.62503405 260532.888690099 NULL 2080.4098),
 CIRCULARSTRING (2173324.62503405 260532.888690099 NULL 2080.4098,2173345.78352624 260520.72691965 NULL 0,2173364.04390489 260504.535902888 NULL 2129.3036),
 CIRCULARSTRING (2173364.04390489 260504.535902888 NULL 2129.3036,2173381.19882422 260470.679448103 NULL 0,2173378.16228123 260432.846523359 NULL 2206.1746),
 (2173378.16228123 260432.846523359 NULL 2206.1746,2173355.55940427 260371.804622516 NULL 2271.2667,2173350.99754606 260362.115766078 NULL 2281.9758),
 CIRCULARSTRING (2173350.99754606 260362.115766078 NULL 2281.9758,2173336.7026266 260144.609642233 NULL 0,2173474.30695651 259975.558445781 NULL 2728.2803),
 (2173474.30695651 259975.558445781 NULL 2728.2803,2173476.92754695 259974.081665367 NULL 2731.2883),
 CIRCULARSTRING (2173476.92754695 259974.081665367 NULL 2731.2883,2173644.89258743 259822.983578196 NULL 0,2173732.74541767 259614.837554961 NULL 3186.7865),
 CIRCULARSTRING (2173732.74541767 259614.837554961 NULL 3186.7865,2173749.05001496 259459.972709981 NULL 0,2173742.0037621 259304.411434516 NULL 3498.52))', 2274),
 'ALL',NULL,NULL,NULL,NULL,8,8,4
 ) as v)
SELECT d.id, d.geometry_type, 'Before' as text, d.segment as Geom, d.segment.AsTextZM() as rGeom from Ramp_H_Segmentized as d
UNION ALL
SELECT d.id, d.geometry_type, 'Square Buffer' as text, [dbo].[STSquareBuffer] (d.segment, 70, 3, 1) as Geom, [dbo].[STSquareBuffer] (d.segment, 70, 3, 1).AsTextZM() as rGeom from Ramp_H_Segmentized as d;

-- OK
with Ramp_H_Segmentized as (
SELECT v.*
 FROM [dbo].[STSegmentize] (
 geometry::STGeomFromText('COMPOUNDCURVE ((2173251.19755045 260565.663264811 NULL 2000,2173324.62503405 260532.888690099 NULL 2080.4098),
 CIRCULARSTRING (2173324.62503405 260532.888690099 NULL 2080.4098,2173345.78352624 260520.72691965 NULL 0,2173364.04390489 260504.535902888 NULL 2129.3036),
 CIRCULARSTRING (2173364.04390489 260504.535902888 NULL 2129.3036,2173381.19882422 260470.679448103 NULL 0,2173378.16228123 260432.846523359 NULL 2206.1746),
 (2173378.16228123 260432.846523359 NULL 2206.1746,2173355.55940427 260371.804622516 NULL 2271.2667,2173350.99754606 260362.115766078 NULL 2281.9758),
 CIRCULARSTRING (2173350.99754606 260362.115766078 NULL 2281.9758,2173336.7026266 260144.609642233 NULL 0,2173474.30695651 259975.558445781 NULL 2728.2803),
 (2173474.30695651 259975.558445781 NULL 2728.2803,2173476.92754695 259974.081665367 NULL 2731.2883),
 CIRCULARSTRING (2173476.92754695 259974.081665367 NULL 2731.2883,2173644.89258743 259822.983578196 NULL 0,2173732.74541767 259614.837554961 NULL 3186.7865),
 CIRCULARSTRING (2173732.74541767 259614.837554961 NULL 3186.7865,2173749.05001496 259459.972709981 NULL 0,2173742.0037621 259304.411434516 NULL 3498.52))', 2274),
 'ALL',NULL,NULL,NULL,NULL,8,8,4
 ) as v)
SELECT d.id, d.geometry_type, 'Before' as text, d.segment as Geom from Ramp_H_Segmentized as d
UNION ALL
SELECT d.id, d.geometry_type, 'Square Buffer' as text, [dbo].[STSquareBuffer] (d.segment, 50, 3, 1) as Geom from Ramp_H_Segmentized as d;

-- OK
with Ramp_H1_Segmentized as (
SELECT v.*
 FROM [dbo].[STSegmentize] (
        geometry::STGeomFromText('COMPOUNDCURVE ((2173369.79254475 259887.575230554 NULL 2600,2173381.122467 259911.320734575 NULL 2626.3106),
                                  CIRCULARSTRING (2173381.122467 259911.320734575 NULL 2626.3106,2173433.84355779 259955.557426129 NULL 0,2173501.82006501 259944.806018785 NULL 2768.24))', 2274),
        'ALL',NULL,NULL,NULL,NULL,8,8,4
       ) as v)
SELECT d.id, d.geometry_type, 'Before' as text, d.segment as Geom from Ramp_H1_Segmentized as d
UNION ALL
SELECT d.id, d.geometry_type, 'Square Buffer' as text, [dbo].[STSquareBuffer] (d.segment, 100, 3, 1) as Geom from Ramp_H1_Segmentized as d;

-- OK
with Ramp_H1_Segmentized as (
SELECT v.*
 FROM [dbo].[STSegmentize] (
 geometry::STGeomFromText('COMPOUNDCURVE ((2173369.79254475 259887.575230554 NULL 2600,2173381.122467 259911.320734575 NULL 2626.3106),
 CIRCULARSTRING (2173381.122467 259911.320734575 NULL 2626.3106,2173433.84355779 259955.557426129 NULL 0,2173501.82006501 259944.806018785 NULL 2768.24))', 2274),
 'ALL',NULL,NULL,NULL,NULL,8,8,4
 ) as v)
SELECT 'Before' as text, d.segment as Geom, d.segment.AsTextZM() as rGeom from Ramp_H1_Segmentized as d
UNION ALL
SELECT 'Square Buffer' as text, [dbo].[STSquareBuffer] (d.segment, 70, 3, 1) as Geom, [dbo].[STSquareBuffer] (d.segment, 70, 3, 1).AsTextZM() as rGeom from Ramp_H1_Segmentized as d;

-- OK
with Ramp_H1_Segmentized as (
SELECT v.*
 FROM [dbo].[STSegmentize] (
 geometry::STGeomFromText('COMPOUNDCURVE ((2173369.79254475 259887.575230554 NULL 2600,2173381.122467 259911.320734575 NULL 2626.3106),
 CIRCULARSTRING (2173381.122467 259911.320734575 NULL 2626.3106,2173433.84355779 259955.557426129 NULL 0,2173501.82006501 259944.806018785 NULL 2768.24))', 2274),
 'ALL',NULL,NULL,NULL,NULL,8,8,4
 ) as v)
SELECT 'Before' as text, d.segment as Geom, d.segment.AsTextZM() as rGeom from Ramp_H1_Segmentized as d
UNION ALL
SELECT 'Square Buffer' as text, [dbo].[STSquareBuffer] (d.segment, 50, 3, 1) as Geom, [dbo].[STSquareBuffer] (d.segment, 50, 3, 1).AsTextZM() as rGeom from Ramp_H1_Segmentized as d;

-- OK
-- All sq buffers generated correctly.
with RFP1_Segmentized as (
SELECT v.*
 FROM [dbo].[STSegmentize] (
 geometry::STGeomFromText('COMPOUNDCURVE ((2172150.6845635027 258351.6130952388 NULL 7500, 2171796.8166267127 257562.7279690057 NULL 8364.6171999999933), 
CIRCULARSTRING (2171796.8166267127 257562.7279690057 NULL 8364.6171999999933, 2171785.1539784111 257183.20449278614 NULL 0, 2172044.2970194966 256905.68157368898 NULL 9143.7173000000039), 
(2172044.2970194966 256905.68157368898 NULL 9143.7173000000039, 2172405.6545540541 256740.52740873396 NULL 9541.0274000000063), 
CIRCULARSTRING (2172405.6545540541 256740.52740873396 NULL 9541.0274000000063, 2172647.6470565521 256579.20296130711 NULL 0, 2172826.9283746332 256350.1960671097 NULL 10125.168300000005), 
(2172826.9283746332 256350.1960671097 NULL 10125.168300000005, 2172922.0147634745 256178.15253089368 NULL 10321.740000000005))', 2274),
 'ALL',NULL,NULL,NULL,NULL,8,8,4
 ) as v)
SELECT 'Before' as text, d.segment as Geom, d.segment.AsTextZM() as rGeom from RFP1_Segmentized as d
UNION ALL
SELECT 'Square Buffer' as text, [dbo].[STSquareBuffer] (d.segment, 500, 3, 1) as Geom, [dbo].[STSquareBuffer] (d.segment, 500, 3, 1).AsTextZM() as rGeom from RFP1_Segmentized as d;

-- OK
WITH RFP2 as (
 select geometry::STGeomFromText('COMPOUNDCURVE ((2172689.5850816667 263297.43350273371 NULL 20000, 2172870.5653368235 263341.6981946826 NULL 20186.314400000003), 
CIRCULARSTRING (2172870.5653368235 263341.6981946826 NULL 20186.314400000003, 2172949.36071442 263374.02539862844 NULL 0, 2173015.1427358091 263428.122397691 NULL 20357.287800000006), 
(2173015.1427358091 263428.122397691 NULL 20357.287800000006, 2173091.9710562378 263513.43623405695 NULL 20472.096300000005), 
CIRCULARSTRING (2173091.9710562378 263513.43623405695 NULL 20472.096300000005, 2173234.6914302604 263621.66524513043 NULL 0, 2173407.26756607 263669.62461698055 NULL 20832.466700000004), 
(2173407.26756607 263669.62461698055 NULL 20832.466700000004, 2173737.8756920993 263696.85831338167 NULL 21164.1939), 
CIRCULARSTRING (2173737.8756920993 263696.85831338167 NULL 21164.1939, 2174060.2842410011 263742.02676398389 NULL 0, 2174375.4616589993 263823.57832141221 NULL 21815.659499999994), 
(2174375.4616589993 263823.57832141221 NULL 21815.659499999994, 2174455.1104600877 263849.10933355987 NULL 21899.300000000003))',2274) as geom
 )
SELECT [dbo].[STSquareBuffer](a.geom, 50, 3, 1) as sqBuff from RFP2 as a
GO

-- OK
with RFP2_Segmentized as (SELECT v.*
 FROM [dbo].[STSegmentize] (
 geometry::STGeomFromText('COMPOUNDCURVE ((2172689.5850816667 263297.43350273371 NULL 20000, 2172870.5653368235 263341.6981946826 NULL 20186.314400000003), 
CIRCULARSTRING (2172870.5653368235 263341.6981946826 NULL 20186.314400000003, 2172949.36071442 263374.02539862844 NULL 0, 2173015.1427358091 263428.122397691 NULL 20357.287800000006), 
(2173015.1427358091 263428.122397691 NULL 20357.287800000006, 2173091.9710562378 263513.43623405695 NULL 20472.096300000005), 
CIRCULARSTRING (2173091.9710562378 263513.43623405695 NULL 20472.096300000005, 2173234.6914302604 263621.66524513043 NULL 0, 2173407.26756607 263669.62461698055 NULL 20832.466700000004), 
(2173407.26756607 263669.62461698055 NULL 20832.466700000004, 2173737.8756920993 263696.85831338167 NULL 21164.1939), 
CIRCULARSTRING (2173737.8756920993 263696.85831338167 NULL 21164.1939, 2174060.2842410011 263742.02676398389 NULL 0, 2174375.4616589993 263823.57832141221 NULL 21815.659499999994), 
(2174375.4616589993 263823.57832141221 NULL 21815.659499999994, 2174455.1104600877 263849.10933355987 NULL 21899.300000000003))', 2274),
 'ALL',NULL,NULL,NULL,NULL,8,8,4
 ) as v)
SELECT 'Before' as text, d.segment as Geom, d.segment.AsTextZM() as rGeom from RFP2_Segmentized as d
UNION ALL
SELECT 'Square Buffer' as text, [dbo].[STSquareBuffer] (d.segment, 500, 3, 1) as Geom, [dbo].[STSquareBuffer] (d.segment, 500, 3, 1).AsTextZM() as rGeom from RFP2_Segmentized as d;

-- OK
WITH I124 as (
 select geometry::STGeomFromText('CompoundCurve (
CircularString (2172207.12090003490447998 256989.8612000048160553 NULL 11200, 2172337.52737651020288467 257437.9648682993138209 NULL 0, 2172663.83167292177677155 257771.62375517189502716 NULL 12142.83130000000528526),
 (2172663.83167292177677155 257771.62375517189502716 NULL 12142.83130000000528526, 2173053.90566198527812958 258011.32397928833961487 NULL 12600.66749999999592546),
CircularString (2173053.90566198527812958 258011.32397928833961487 NULL 12600.66749999999592546, 2173287.01136440876871347 258189.96358297357801348 NULL 0, 2173478.70718778669834137 258412.45647680759429932 NULL 13189.07289999999920838),
CircularString (2173478.70718778669834137 258412.45647680759429932 NULL 13189.07289999999920838, 2173748.77927610510960221 258973.8411394071590621 NULL 0, 2173828.65654586255550385 259591.66902326047420502 NULL 14440.33909999999741558),
 (2173828.65654586255550385 259591.66902326047420502 NULL 14440.33909999999741558, 2173758.29399192333221436 261836.17986378073692322 NULL 16685.95260000000416767),
CircularString (2173758.29399192333221436 261836.17986378073692322 NULL 16685.95260000000416767, 2173725.78396705072373152 262165.54628049046732485 NULL 0, 2173649.53159222006797791 262487.60949401557445526 NULL 17348.38270000000193249),
 (2173649.53159222006797791 262487.60949401557445526 NULL 17348.38270000000193249, 2173560.78142566978931427 262776.41380821168422699 NULL 17650.51600000000325963),
CircularString (2173560.78142566978931427 262776.41380821168422699 NULL 17650.51600000000325963, 2173487.32788622565567493 263024.51879732898669317 NULL 0, 2173420.50443191826343536 263274.49106386303901672 NULL 18168.03109999999287538),
 (2173420.50443191826343536 263274.49106386303901672 NULL 18168.03109999999287538, 2173069.13725355267524719 264662.68272183835506439 NULL 19600, 2172750.15174546837806702 265922.93993593752384186 NULL 20900))',2274) as geom
 )
SELECT [dbo].[STSquareBuffer](a.geom, 50, 3, 1) as sqBuff from I124 as a
GO

-- OK
with I124_Segmentized as (
SELECT v.*
 FROM [dbo].[STSegmentize] (
 geometry::STGeomFromText('CompoundCurve (
CircularString (2172207.12090003490447998 256989.8612000048160553 NULL 11200, 2172337.52737651020288467 257437.9648682993138209 NULL 0, 2172663.83167292177677155 257771.62375517189502716 NULL 12142.83130000000528526),
 (2172663.83167292177677155 257771.62375517189502716 NULL 12142.83130000000528526, 2173053.90566198527812958 258011.32397928833961487 NULL 12600.66749999999592546),
CircularString (2173053.90566198527812958 258011.32397928833961487 NULL 12600.66749999999592546, 2173287.01136440876871347 258189.96358297357801348 NULL 0, 2173478.70718778669834137 258412.45647680759429932 NULL 13189.07289999999920838),
CircularString (2173478.70718778669834137 258412.45647680759429932 NULL 13189.07289999999920838, 2173748.77927610510960221 258973.8411394071590621 NULL 0, 2173828.65654586255550385 259591.66902326047420502 NULL 14440.33909999999741558),
 (2173828.65654586255550385 259591.66902326047420502 NULL 14440.33909999999741558, 2173758.29399192333221436 261836.17986378073692322 NULL 16685.95260000000416767),
CircularString (2173758.29399192333221436 261836.17986378073692322 NULL 16685.95260000000416767, 2173725.78396705072373152 262165.54628049046732485 NULL 0, 2173649.53159222006797791 262487.60949401557445526 NULL 17348.38270000000193249),
 (2173649.53159222006797791 262487.60949401557445526 NULL 17348.38270000000193249, 2173560.78142566978931427 262776.41380821168422699 NULL 17650.51600000000325963),
CircularString (2173560.78142566978931427 262776.41380821168422699 NULL 17650.51600000000325963, 2173487.32788622565567493 263024.51879732898669317 NULL 0, 2173420.50443191826343536 263274.49106386303901672 NULL 18168.03109999999287538),
 (2173420.50443191826343536 263274.49106386303901672 NULL 18168.03109999999287538, 2173069.13725355267524719 264662.68272183835506439 NULL 19600, 2172750.15174546837806702 265922.93993593752384186 NULL 20900))', 2274),
 'ALL',NULL,NULL,NULL,NULL,8,8,4
 ) as v)
SELECT 'Before' as text, d.segment as Geom from I124_Segmentized as d
UNION ALL
SELECT 'Square Buffer' as text, [dbo].[STSquareBuffer] (d.segment, 500, 3, 1) as Geom from I124_Segmentized as d;

-- OK
WITH RFP1 as (
 select geometry::STGeomFromText('COMPOUNDCURVE ((2172150.6845635027 258351.6130952388 NULL 7500, 2171796.8166267127 257562.7279690057 NULL 8364.6171999999933), 
CIRCULARSTRING (2171796.8166267127 257562.7279690057 NULL 8364.6171999999933, 2171785.1539784111 257183.20449278614 NULL 0, 2172044.2970194966 256905.68157368898 NULL 9143.7173000000039), 
(2172044.2970194966 256905.68157368898 NULL 9143.7173000000039, 2172405.6545540541 256740.52740873396 NULL 9541.0274000000063), 
CIRCULARSTRING (2172405.6545540541 256740.52740873396 NULL 9541.0274000000063, 2172647.6470565521 256579.20296130711 NULL 0, 2172826.9283746332 256350.1960671097 NULL 10125.168300000005), 
(2172826.9283746332 256350.1960671097 NULL 10125.168300000005, 2172922.0147634745 256178.15253089368 NULL 10321.740000000005))',2274) as geom
 )
SELECT [dbo].[STSquareBuffer](a.geom, 50, 5, 4) as sqBuff from RFP1 as a
GO
