use DEVDB
go

with data as (
--select geometry::STGeomFromText('CompoundCurve (CircularString (2172207.12090003490447998 256989.8612000048160553 NULL 11200, 2172337.52737651020288467 257437.9648682993138209 NULL 0, 2172663.83167292177677155 257771.62375517189502716 NULL 12142.83130000000528526),(2172663.83167292177677155 257771.62375517189502716 NULL 12142.83130000000528526, 2173053.90566198527812958 258011.32397928833961487 NULL 12600.66749999999592546))',2274) as line
select geometry::STGeomFromText('CompoundCurve (
CircularString (2172207.12090003490447998 256989.8612000048160553 NULL 11200, 2172337.52737651020288467 257437.9648682993138209 NULL 0, 2172663.83167292177677155 257771.62375517189502716 NULL 12142.83130000000528526),
(2172663.83167292177677155 257771.62375517189502716 NULL 12142.83130000000528526, 2173053.90566198527812958 258011.32397928833961487 NULL 12600.66749999999592546),
CircularString (2173053.90566198527812958 258011.32397928833961487 NULL 12600.66749999999592546, 2173287.01136440876871347 258189.96358297357801348 NULL 0, 2173478.70718778669834137 258412.45647680759429932 NULL 13189.07289999999920838),
CircularString (2173478.70718778669834137 258412.45647680759429932 NULL 13189.07289999999920838, 2173748.77927610510960221 258973.8411394071590621 NULL 0, 2173828.65654586255550385 259591.66902326047420502 NULL 14440.33909999999741558),
(2173828.65654586255550385 259591.66902326047420502 NULL 14440.33909999999741558, 2173758.29399192333221436 261836.17986378073692322 NULL 16685.95260000000416767),
CircularString (2173758.29399192333221436 261836.17986378073692322 NULL 16685.95260000000416767, 2173725.78396705072373152 262165.54628049046732485 NULL 0, 2173649.53159222006797791 262487.60949401557445526 NULL 17348.38270000000193249),
(2173649.53159222006797791 262487.60949401557445526 NULL 17348.38270000000193249, 2173560.78142566978931427 262776.41380821168422699 NULL 17650.51600000000325963),
CircularString (
2173560.78142566978931427 262776.41380821168422699 NULL 17650.51600000000325963, 
2173487.32788622565567493 263024.51879732898669317 NULL 0, 
2173420.50443191826343536 263274.49106386303901672 NULL 18168.03109999999287538),
(2173420.50443191826343536 263274.49106386303901672 NULL 18168.03109999999287538, 2173069.13725355267524719 264662.68272183835506439 NULL 19600, 2172750.15174546837806702 265922.93993593752384186 NULL 20900))',2274) 
as line
)
--select cast(null as float) as iLength,cast(null as float) as offset,A.line from data as a union all
select lineIncrement.IntValue as lLength,
       offset.IntValue as offset,
       [lrs].[STFindPointByLength](line,lineIncrement.IntValue,offset.IntValue,3,2).STBuffer(5.0) as fPoint --.AsTextZM() as fPoint
into dbo.rayner
  from data as a
       cross apply
	   dbo.Generate_Series(0,ROUND(a.line.STLength(),3),100) as lineIncrement
	   cross apply
	   dbo.Generate_Series(-5,5,5) as offset



-- select [dbo].[STSquareBuffer](a.line,5,3,2) as sQ from data as a;

USE DEPLOYDB
GO


select case when r.routine_schema = 'lrs' then 'LRS' else 'GENERAL' end category, count(*) as count_by_type
  from [INFORMATION_SCHEMA].[ROUTINES] as r
 where r.routine_schema in ('dbo','lrs','cogo')
   and r.specific_name not like 'sp%'
   and r.specific_name not like 'fn%'
group by case when r.routine_schema = 'lrs' then 'LRS' else 'GENERAL' end;
